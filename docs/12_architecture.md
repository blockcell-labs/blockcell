# ç¬¬12ç¯‡ï¼šblockcell æ¶æ„æ·±åº¦è§£æ â€”â€” ä¸ºä»€ä¹ˆç”¨ Rust å†™ AI æ¡†æ¶

> ç³»åˆ—æ–‡ç« ï¼šã€Šblockcell å¼€æºé¡¹ç›®æ·±åº¦è§£æã€‹ç¬¬ 12/14 ç¯‡

---

## å¼€ç¯‡ï¼šä¸€ä¸ªåç›´è§‰çš„é€‰æ‹©

AI æ¡†æ¶é€šå¸¸ç”¨ Python å†™ã€‚LangChainã€AutoGPTã€CrewAIâ€¦â€¦å‡ ä¹æ‰€æœ‰çŸ¥åçš„ AI æ™ºèƒ½ä½“æ¡†æ¶éƒ½æ˜¯ Pythonã€‚

blockcell é€‰æ‹©äº† Rustã€‚

è¿™ä¸æ˜¯ä¸ºäº†"ç‚«æŠ€"ï¼Œè€Œæ˜¯æœ‰æ·±æ€ç†Ÿè™‘çš„å·¥ç¨‹ç†ç”±ã€‚æœ¬ç¯‡ä»æ¶æ„è§’åº¦æ·±åº¦è§£æ blockcell çš„è®¾è®¡å†³ç­–ã€‚

---

## æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ¥å£å±‚                                â”‚
â”‚  CLI (agent/gateway)  â”‚  HTTP API  â”‚  WebSocket  â”‚  WebUI   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶ˆæ¯è·¯ç”±å±‚                                â”‚
â”‚  InboundMessage â†’ AgentRuntime â†’ OutboundMessage            â”‚
â”‚  æ¸ é“ï¼šTelegram â”‚ Slack â”‚ Discord â”‚ é£ä¹¦ â”‚ WhatsApp         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent æ ¸å¿ƒå±‚ï¼ˆTCBï¼‰                       â”‚
â”‚  ContextBuilder â”‚ IntentClassifier â”‚ TaskManager            â”‚
â”‚  AgentRuntime   â”‚ EvolutionService â”‚ CapabilityRegistry     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å·¥å…·å±‚ï¼ˆToolsï¼‰    â”‚    â”‚      æŠ€èƒ½å±‚ï¼ˆSkillsï¼‰           â”‚
â”‚  50+ å†…ç½®å·¥å…·         â”‚    â”‚  Rhai è„šæœ¬å¼•æ“                  â”‚
â”‚  ToolRegistry        â”‚    â”‚  SkillManager                  â”‚
â”‚  JSON Schema éªŒè¯     â”‚    â”‚  SkillDispatcher               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­˜å‚¨å±‚ï¼ˆStorageï¼‰                         â”‚
â”‚  SQLiteï¼ˆè®°å¿†/ä¼šè¯/å®¡è®¡ï¼‰  â”‚  æ–‡ä»¶ç³»ç»Ÿï¼ˆæŠ€èƒ½/åª’ä½“/é…ç½®ï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Provider å±‚                              â”‚
â”‚  OpenAI â”‚ Anthropic â”‚ Gemini â”‚ Ollama â”‚ DeepSeek â”‚ Kimi     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Crate ç»“æ„

blockcell æ˜¯ä¸€ä¸ª Cargo workspaceï¼Œç”± 9 ä¸ª crate ç»„æˆï¼š

```
blockcell/
â”œâ”€â”€ bin/blockcell/          # å¯æ‰§è¡Œæ–‡ä»¶å…¥å£
â””â”€â”€ crates/
    â”œâ”€â”€ core/               # é…ç½®ã€è·¯å¾„ã€å…±äº«ç±»å‹ã€é”™è¯¯
    â”œâ”€â”€ agent/              # Agent è¿è¡Œæ—¶ã€ä¸Šä¸‹æ–‡ã€æ„å›¾åˆ†ç±»
    â”œâ”€â”€ tools/              # 50+ å†…ç½®å·¥å…· + å·¥å…·æ³¨å†Œè¡¨
    â”œâ”€â”€ skills/             # Rhai å¼•æ“ã€æŠ€èƒ½ç®¡ç†ã€è¿›åŒ–æœåŠ¡
    â”œâ”€â”€ storage/            # SQLite è®°å¿†ã€ä¼šè¯ã€å®¡è®¡æ—¥å¿—
    â”œâ”€â”€ channels/           # æ¶ˆæ¯æ¸ é“é€‚é…å™¨
    â”œâ”€â”€ providers/          # LLM Provider å®¢æˆ·ç«¯
    â”œâ”€â”€ scheduler/          # Cron è°ƒåº¦å™¨
    â””â”€â”€ updater/            # è‡ªå‡çº§å·¥å…·
```

æ¯ä¸ª crate èŒè´£å•ä¸€ï¼Œä¾èµ–å…³ç³»æ¸…æ™°ï¼š

```
bin â†’ agent â†’ tools â†’ core
           â†’ skills â†’ core
           â†’ storage â†’ core
           â†’ channels â†’ core
           â†’ providers â†’ core
           â†’ scheduler â†’ core
```

---

## ä¸ºä»€ä¹ˆé€‰æ‹© Rust

### ç†ç”±ä¸€ï¼šå†…å­˜å®‰å…¨ = å¯ä¿¡è®¡ç®—åŸº

blockcell çš„è®¾è®¡ç†å¿µæ˜¯ **TCBï¼ˆTrusted Computing Baseï¼Œå¯ä¿¡è®¡ç®—åŸºï¼‰**ã€‚

Rust å®¿ä¸»æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨è¾¹ç•Œã€‚AI ç”Ÿæˆçš„ä»£ç ï¼ˆRhai è„šæœ¬ï¼‰åœ¨è¿™ä¸ªè¾¹ç•Œå†…è¿è¡Œï¼Œæ— æ³•çªç ´ã€‚

Python çš„é—®é¢˜æ˜¯ï¼šå†…å­˜é”™è¯¯ã€ç±»å‹é”™è¯¯ã€å¹¶å‘é—®é¢˜éƒ½å¯èƒ½åœ¨è¿è¡Œæ—¶å‡ºç°ï¼Œå¾ˆéš¾åœ¨ç¼–è¯‘æœŸå‘ç°ã€‚Rust çš„æ‰€æœ‰æƒç³»ç»Ÿåœ¨ç¼–è¯‘æœŸå°±æ’é™¤äº†è¿™äº›é—®é¢˜ã€‚

```rust
// Rust ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæ‹’ç»è¿™æ®µä»£ç 
fn bad_code() {
    let data = vec![1, 2, 3];
    let ref1 = &data;
    data.push(4);  // é”™è¯¯ï¼šä¸èƒ½åœ¨æœ‰ä¸å¯å˜å€Ÿç”¨æ—¶ä¿®æ”¹
    println!("{:?}", ref1);
}
```

### ç†ç”±äºŒï¼šå¼‚æ­¥å¹¶å‘ = é«˜æ•ˆå¤šä»»åŠ¡

blockcell éœ€è¦åŒæ—¶å¤„ç†ï¼š
- å¤šä¸ªæ¶ˆæ¯æ¸ é“çš„è½®è¯¢
- å¤šä¸ªåå°ä»»åŠ¡çš„æ‰§è¡Œ
- å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦
- WebSocket è¿æ¥çš„ç»´æŠ¤

Rust çš„ `tokio` å¼‚æ­¥è¿è¡Œæ—¶è®©è¿™ä¸€åˆ‡éƒ½åœ¨**å•è¿›ç¨‹å†…é«˜æ•ˆè¿è¡Œ**ï¼Œæ²¡æœ‰ Python GIL çš„é™åˆ¶ï¼š

```rust
// å¤šä¸ªä»»åŠ¡å¹¶å‘è¿è¡Œï¼Œäº’ä¸é˜»å¡
tokio::select! {
    msg = inbound_rx.recv() => { /* å¤„ç†æ–°æ¶ˆæ¯ */ }
    _ = tick_interval.tick() => { /* å®šæ—¶ç»´æŠ¤ */ }
    _ = shutdown_signal() => { break; }
}
```

### ç†ç”±ä¸‰ï¼šå•äºŒè¿›åˆ¶ = ç®€å•éƒ¨ç½²

Python åº”ç”¨éƒ¨ç½²éœ€è¦ï¼š
- Python ç¯å¢ƒ
- pip ä¾èµ–
- è™šæ‹Ÿç¯å¢ƒ
- å¯èƒ½è¿˜éœ€è¦ Docker

blockcell ç¼–è¯‘åæ˜¯**ä¸€ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶**ï¼Œç›´æ¥è¿è¡Œï¼Œé›¶ä¾èµ–ï¼š

```bash
# å°±è¿™ä¹ˆç®€å•
./blockcell gateway
```

### ç†ç”±å››ï¼šæ€§èƒ½ = ä½æˆæœ¬è¿è¡Œ

åœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œ AI æ™ºèƒ½ä½“ï¼Œè®¡ç®—æˆæœ¬ä¸»è¦æ¥è‡ª LLM API è°ƒç”¨ï¼Œè€Œä¸æ˜¯æ¡†æ¶æœ¬èº«ã€‚

ä½† Rust çš„ä½å†…å­˜å ç”¨ï¼ˆé€šå¸¸ < 50MBï¼‰æ„å‘³ç€ä½ å¯ä»¥åœ¨æœ€ä¾¿å®œçš„ VPS ä¸Šè¿è¡Œ blockcellï¼Œè€Œ Python æ¡†æ¶å¯èƒ½éœ€è¦ 200-500MB å†…å­˜ã€‚

---

## å…³é”®è®¾è®¡æ¨¡å¼

### æ¨¡å¼ä¸€ï¼šTrait å¯¹è±¡å®ç°å¤šæ€

blockcell å¤§é‡ä½¿ç”¨ Rust çš„ Trait å¯¹è±¡ï¼ˆ`dyn Trait`ï¼‰å®ç°å¤šæ€ï¼Œè¿™è®©ä¸åŒçš„å®ç°å¯ä»¥äº’æ¢ï¼š

```rust
// Provider traitï¼šæ‰€æœ‰ LLM æä¾›å•†çš„ç»Ÿä¸€æ¥å£
pub trait Provider: Send + Sync {
    async fn chat(&self, messages: Vec<ChatMessage>, tools: Vec<Tool>) 
        -> Result<ChatResponse>;
}

// å…·ä½“å®ç°
struct OpenAIProvider { ... }
struct AnthropicProvider { ... }
struct GeminiProvider { ... }
struct OllamaProvider { ... }

// è¿è¡Œæ—¶æ ¹æ®é…ç½®é€‰æ‹©
let provider: Box<dyn Provider> = match model_prefix {
    "claude-" => Box::new(AnthropicProvider::new(...)),
    "gemini-" => Box::new(GeminiProvider::new(...)),
    "ollama/" => Box::new(OllamaProvider::new(...)),
    _ => Box::new(OpenAIProvider::new(...)),
};
```

### æ¨¡å¼äºŒï¼šArc<dyn Trait> è·¨çº¿ç¨‹å…±äº«

å­æ™ºèƒ½ä½“éœ€è¦è®¿é—®ä¸»æ™ºèƒ½ä½“çš„èµ„æºï¼ˆTaskManagerã€MemoryStore ç­‰ï¼‰ï¼Œé€šè¿‡ `Arc<dyn Trait>` å®‰å…¨å…±äº«ï¼š

```rust
// ç±»å‹åˆ«åï¼Œç®€åŒ–ä½¿ç”¨
pub type TaskManagerHandle = Arc<dyn TaskManagerOps + Send + Sync>;
pub type MemoryStoreHandle = Arc<dyn MemoryStoreOps + Send + Sync>;
pub type CapabilityRegistryHandle = Arc<Mutex<CapabilityRegistry>>;

// ToolContext æºå¸¦æ‰€æœ‰å…±äº«èµ„æº
pub struct ToolContext {
    pub config: Arc<Config>,
    pub task_manager: Option<TaskManagerHandle>,
    pub memory_store: Option<MemoryStoreHandle>,
    pub capability_registry: Option<CapabilityRegistryHandle>,
    // ...
}
```

### æ¨¡å¼ä¸‰ï¼šChannel è§£è€¦æ¶ˆæ¯æµ

æ¶ˆæ¯çš„æµè½¬é€šè¿‡ `tokio::mpsc` channel è§£è€¦ï¼š

```
stdin/Telegram/Slack â†’ inbound_tx â†’ AgentRuntime
AgentRuntime â†’ outbound_tx â†’ æ‰“å°/Telegram/Slack
AgentRuntime â†’ confirm_tx â†’ ç”¨æˆ·ç¡®è®¤
```

è¿™è®©æ¶ˆæ¯æ¥æºå’Œå¤„ç†é€»è¾‘å®Œå…¨è§£è€¦ï¼Œæ·»åŠ æ–°æ¸ é“åªéœ€è¦å¾€ `inbound_tx` å‘æ¶ˆæ¯ã€‚

### æ¨¡å¼å››ï¼šJSON Schema é©±åŠ¨çš„å·¥å…·ç³»ç»Ÿ

æ¯ä¸ªå·¥å…·éƒ½é€šè¿‡ JSON Schema æè¿°è‡ªå·±ï¼š

```rust
pub trait Tool: Send + Sync {
    fn name(&self) -> &str;
    fn schema(&self) -> Value;        // JSON Schema
    fn validate(&self, params: &Value) -> Result<()>;
    async fn execute(&self, params: Value, ctx: ToolContext) -> Result<Value>;
}
```

è¿™ä¸ªè®¾è®¡çš„å¥½å¤„ï¼š
1. LLM é€šè¿‡ schema çŸ¥é“å¦‚ä½•è°ƒç”¨å·¥å…·
2. å‚æ•°åœ¨æ‰§è¡Œå‰ç»è¿‡ schema éªŒè¯
3. æ·»åŠ æ–°å·¥å…·åªéœ€å®ç° traitï¼Œä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 

---

## æ„å›¾åˆ†ç±»ä¼˜åŒ– Token æ¶ˆè€—

è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„å·¥ç¨‹ä¼˜åŒ–ã€‚

æ¯æ¬¡å¯¹è¯éƒ½éœ€è¦æŠŠå·¥å…·åˆ—è¡¨å‘ç»™ LLMï¼Œä½† 50+ ä¸ªå·¥å…·çš„ schema åŠ èµ·æ¥æœ‰ ~20,000 tokensï¼Œæˆæœ¬å¾ˆé«˜ã€‚

blockcell å®ç°äº†ä¸€ä¸ª**æ„å›¾åˆ†ç±»å™¨**ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥åªå‘é€ç›¸å…³å·¥å…·ï¼š

```rust
// 14 ä¸ªæ„å›¾ç±»åˆ«
enum IntentCategory {
    Chat,           // é—²èŠ â†’ 0 ä¸ªå·¥å…·
    FileOps,        // æ–‡ä»¶æ“ä½œ â†’ ~8 ä¸ªå·¥å…·
    WebSearch,      // ç½‘ç»œæœç´¢ â†’ ~5 ä¸ªå·¥å…·
    Finance,        // é‡‘è â†’ ~19 ä¸ªå·¥å…·
    Blockchain,     // åŒºå—é“¾ â†’ ~8 ä¸ªå·¥å…·
    // ...
}
```

Token èŠ‚çœæ•ˆæœï¼š

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|------|--------|--------|------|
| "ä½ å¥½" | ~20K | ~800 | -96% |
| æ–‡ä»¶æ“ä½œ | ~20K | ~4K | -80% |
| é‡‘èæŸ¥è¯¢ | ~20K | ~8K | -60% |

---

## Rhai è„šæœ¬å¼•æ“çš„é€‰æ‹©

ä¸ºä»€ä¹ˆé€‰æ‹© Rhai è€Œä¸æ˜¯ Lua æˆ– JavaScriptï¼Ÿ

| ç‰¹æ€§ | Rhai | Lua | JavaScript (Deno) |
|------|------|-----|-------------------|
| çº¯ Rust å®ç° | âœ… | âŒ | âŒ |
| ç±»å‹å®‰å…¨ | âœ… | âŒ | éƒ¨åˆ† |
| æ²™ç®±éš”ç¦» | âœ… | éœ€é…ç½® | éœ€é…ç½® |
| è¯­æ³•å‹å¥½ | âœ… | ä¸€èˆ¬ | âœ… |
| åµŒå…¥å¤æ‚åº¦ | ä½ | ä¸­ | é«˜ |
| äºŒè¿›åˆ¶å¤§å° | å° | ä¸­ | å¤§ |

Rhai æ˜¯ä¸“ä¸º Rust åµŒå…¥è®¾è®¡çš„è„šæœ¬è¯­è¨€ï¼Œé›¶å¤–éƒ¨ä¾èµ–ï¼Œå¤©ç„¶æ²™ç®±ï¼Œè¯­æ³•æ¥è¿‘ Rust/JavaScriptï¼Œæ˜¯æŠ€èƒ½å±‚çš„å®Œç¾é€‰æ‹©ã€‚

---

## SQLite çš„æˆ˜ç•¥æ€§ä½¿ç”¨

blockcell åœ¨ä¸‰ä¸ªåœ°æ–¹ä½¿ç”¨ SQLiteï¼š

1. **è®°å¿†ç³»ç»Ÿ**ï¼š`memory.db`ï¼ŒFTS5 å…¨æ–‡æœç´¢
2. **çŸ¥è¯†å›¾è°±**ï¼š`knowledge_graphs/*.db`ï¼Œå®ä½“å…³ç³»å›¾
3. **ä¼šè¯å†å²**ï¼š`sessions.db`ï¼Œå¯¹è¯è®°å½•

ä¸ºä»€ä¹ˆä¸ç”¨ PostgreSQL æˆ– Redisï¼Ÿ

- **é›¶è¿ç»´**ï¼šSQLite æ˜¯æ–‡ä»¶ï¼Œä¸éœ€è¦å¯åŠ¨æœåŠ¡
- **è¶³å¤Ÿå¿«**ï¼šå¯¹äºå•ç”¨æˆ·åœºæ™¯ï¼ŒSQLite çš„æ€§èƒ½ç»°ç»°æœ‰ä½™
- **å¯ç§»æ¤**ï¼šæ•´ä¸ªæ•°æ®åº“å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¤‡ä»½/è¿ç§»æç®€å•
- **FTS5**ï¼šå†…ç½®å…¨æ–‡æœç´¢ï¼Œä¸éœ€è¦ Elasticsearch

---

## å®‰å…¨è®¾è®¡

### è·¯å¾„å®‰å…¨

```rust
fn is_path_safe(&self, path: &Path) -> bool {
    let workspace = Paths::workspace();
    // è§„èŒƒåŒ–è·¯å¾„ï¼Œé˜²æ­¢ ../../../etc/passwd æ”»å‡»
    if let Ok(canonical) = path.canonicalize() {
        canonical.starts_with(&workspace)
    } else {
        false
    }
}
```

### ç›®å½•çº§æˆæƒç¼“å­˜

ä¸€æ¬¡æˆæƒï¼Œç›®å½•å†…æ‰€æœ‰æ–‡ä»¶è‡ªåŠ¨å…è®¸ï¼š

```rust
// ç”¨æˆ·æˆæƒäº† /Users/alice/Desktop/project/
// åç»­è®¿é—®è¯¥ç›®å½•å†…ä»»ä½•æ–‡ä»¶éƒ½ä¸å†è¯¢é—®
authorized_dirs: HashSet<PathBuf>
```

### Gateway è®¤è¯

```rust
// Bearer Token ä¸­é—´ä»¶
async fn auth_middleware(
    State(state): State<AppState>,
    req: Request,
    next: Next,
) -> Response {
    if req.uri().path() == "/v1/health" {
        return next.run(req).await;  // å¥åº·æ£€æŸ¥ä¸éœ€è¦è®¤è¯
    }
    // æ£€æŸ¥ Authorization header æˆ– ?token= å‚æ•°
    // ...
}
```

---

## è‡ªå‡çº§ç³»ç»Ÿ

blockcell æœ‰ä¸€ä¸ªå®Œæ•´çš„è‡ªå‡çº§æµç¨‹ï¼š

```
1. æ£€æŸ¥ manifestï¼ˆç‰ˆæœ¬æ¸…å•ï¼‰
2. éªŒè¯ç­¾åï¼ˆed25519-dalekï¼‰
3. ä¸‹è½½æ–°ç‰ˆæœ¬
4. åŸå­æ›¿æ¢ï¼ˆrename ä¿è¯åŸå­æ€§ï¼‰
5. å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
```

```rust
// updater/atomic.rs
pub fn atomic_replace(new_binary: &Path, target: &Path) -> Result<()> {
    let backup = target.with_extension("bak");
    fs::copy(target, &backup)?;  // å¤‡ä»½å½“å‰ç‰ˆæœ¬
    fs::rename(new_binary, target)?;  // åŸå­æ›¿æ¢
    // å¦‚æœåç»­éªŒè¯å¤±è´¥ï¼Œå¯ä»¥ä» backup æ¢å¤
    Ok(())
}
```

---

## ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | blockcell | LangChain | AutoGPT | CrewAI |
|------|-----------|-----------|---------|--------|
| è¯­è¨€ | Rust | Python | Python | Python |
| å†…å­˜å®‰å…¨ | âœ… ç¼–è¯‘æœŸ | âŒ è¿è¡Œæ—¶ | âŒ | âŒ |
| è‡ªæˆ‘è¿›åŒ– | âœ… | âŒ | éƒ¨åˆ† | âŒ |
| æ¶ˆæ¯æ¸ é“ | âœ… 5ä¸ª | éœ€æ’ä»¶ | âŒ | âŒ |
| æœ¬åœ°æ¨¡å‹ | âœ… Ollama | âœ… | âœ… | âœ… |
| å•äºŒè¿›åˆ¶ | âœ… | âŒ | âŒ | âŒ |
| å†…ç½®é‡‘èå·¥å…· | âœ… | âŒ | âŒ | âŒ |
| æµè§ˆå™¨è‡ªåŠ¨åŒ– | âœ… CDP | éœ€æ’ä»¶ | âŒ | âŒ |

---

## å¼€æºè´¡çŒ®æŒ‡å—

å¦‚æœä½ æƒ³ä¸º blockcell è´¡çŒ®ä»£ç ï¼Œè¿™é‡Œæ˜¯å¿«é€Ÿå…¥é—¨ï¼š

### æ·»åŠ ä¸€ä¸ªæ–°å·¥å…·

1. åœ¨ `crates/tools/src/` åˆ›å»ºæ–°æ–‡ä»¶ï¼Œå¦‚ `my_tool.rs`
2. å®ç° `Tool` trait
3. åœ¨ `crates/tools/src/lib.rs` æ·»åŠ  `pub mod my_tool;`
4. åœ¨ `crates/tools/src/registry.rs` æ³¨å†Œå·¥å…·
5. åœ¨ `crates/agent/src/runtime.rs` æ·»åŠ åˆ°å­æ™ºèƒ½ä½“æ³¨å†Œè¡¨
6. åœ¨ `crates/skills/src/service.rs` æ·»åŠ åˆ° `BUILTIN_TOOLS`
7. åœ¨ `crates/agent/src/context.rs` æ·»åŠ ç³»ç»Ÿæç¤ºè¯è§„åˆ™

### æ·»åŠ ä¸€ä¸ªæ–°æ¸ é“

1. åœ¨ `crates/channels/src/` åˆ›å»ºæ–°æ–‡ä»¶
2. å®ç°æ¶ˆæ¯æ¥æ”¶å¾ªç¯ï¼ˆè½®è¯¢æˆ– WebSocketï¼‰
3. å®ç° `send_message()` å‡½æ•°
4. åœ¨ `crates/core/src/config.rs` æ·»åŠ é…ç½®ç»“æ„
5. åœ¨ `bin/blockcell/src/commands/gateway.rs` æ·»åŠ å¯åŠ¨é€»è¾‘

### è¿è¡Œæµ‹è¯•

```bash
cd blockcell
cargo test
# åº”è¯¥çœ‹åˆ° 350+ æµ‹è¯•å…¨éƒ¨é€šè¿‡
```

---

## å°ç»“

blockcell çš„æ¶æ„è®¾è®¡ä½“ç°äº†å‡ ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š

1. **Rust å®¿ä¸» = å¯ä¿¡è®¡ç®—åŸº**ï¼šå®‰å…¨ã€ç¨³å®šã€ä¸å¯å˜
2. **Rhai æŠ€èƒ½ = å¯å˜å±‚**ï¼šçµæ´»ã€å¯è¿›åŒ–ã€æ²™ç®±éš”ç¦»
3. **Trait å¯¹è±¡ = å¯æ‰©å±•æ€§**ï¼šå·¥å…·ã€Providerã€æ¸ é“éƒ½å¯æ’æ‹”
4. **Channel è§£è€¦ = å¯ç»´æŠ¤æ€§**ï¼šæ¶ˆæ¯æµæ¸…æ™°ï¼Œç»„ä»¶ç‹¬ç«‹
5. **SQLite = é›¶è¿ç»´å­˜å‚¨**ï¼šç®€å•å¯é ï¼Œæ— éœ€å¤–éƒ¨æœåŠ¡

è¿™å¥—æ¶æ„è®© blockcell åœ¨ä¿æŒé«˜æ€§èƒ½å’Œå®‰å…¨æ€§çš„åŒæ—¶ï¼Œå…·å¤‡äº†æå¼ºçš„å¯æ‰©å±•æ€§â€”â€”æ— è®ºæ˜¯æ·»åŠ æ–°å·¥å…·ã€æ–°æ¸ é“ï¼Œè¿˜æ˜¯è®© AI è‡ªå·±è¿›åŒ–å‡ºæ–°èƒ½åŠ›ã€‚

---

## ç³»åˆ—æ€»ç»“

æ­å–œä½ è¯»å®Œäº†æ•´ä¸ªç³»åˆ—ï¼æ­£æ–‡å…± 14 ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬è¦†ç›–äº†ï¼š

| ç¯‡ | ä¸»é¢˜ |
|----|------|
| 01 | é¡¹ç›®æ•´ä½“ä»‹ç» |
| 02 | 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ |
| 03 | 50+ å†…ç½®å·¥å…·è¯¦è§£ |
| 04 | Rhai æŠ€èƒ½ç³»ç»Ÿ |
| 05 | SQLite è®°å¿†ç³»ç»Ÿ |
| 06 | å¤šæ¸ é“æ¥å…¥ |
| 07 | CDP æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| 08 | Gateway æœåŠ¡æ¨¡å¼ |
| 09 | è‡ªæˆ‘è¿›åŒ–ç³»ç»Ÿ |
| 10 | é‡‘èåœºæ™¯å®æˆ˜ |
| 11 | å­æ™ºèƒ½ä½“å¹¶å‘ |
| 12 | æ¶æ„æ·±åº¦è§£æ |
| 13 | æ¶ˆæ¯å¤„ç†ä¸è‡ªè¿›åŒ–ç”Ÿå‘½å‘¨æœŸ |
| 14 | åå­—ç”±æ¥ |

blockcell æ˜¯ä¸€ä¸ªè¿˜åœ¨å¿«é€Ÿå‘å±•çš„å¼€æºé¡¹ç›®ã€‚å¦‚æœä½ è§‰å¾—å®ƒæœ‰ç”¨ï¼Œæ¬¢è¿ï¼š
- â­ ç»™é¡¹ç›® Star
- ğŸ› æäº¤ Issue æŠ¥å‘Šé—®é¢˜
- ğŸ”§ æäº¤ PR è´¡çŒ®ä»£ç 
- ğŸ“¢ åˆ†äº«ç»™æ›´å¤šå¼€å‘è€…

---
---

*ä¸Šä¸€ç¯‡ï¼š[å­æ™ºèƒ½ä½“ä¸ä»»åŠ¡å¹¶å‘ â€”â€” è®© AI åŒæ—¶åšå¤šä»¶äº‹](./11_subagents.md)*
*ä¸‹ä¸€ç¯‡ï¼š[æ¶ˆæ¯å¤„ç†ä¸è‡ªè¿›åŒ–ç”Ÿå‘½å‘¨æœŸ](./13_message_processing_and_evolution.md)*

*é¡¹ç›®åœ°å€ï¼šhttps://github.com/blockcell-labs/blockcell*
*å®˜ç½‘ï¼šhttps://blockcell.dev*
